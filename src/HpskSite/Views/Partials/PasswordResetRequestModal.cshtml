@* Modal for requesting a password reset *@
<div class="modal fade" id="passwordResetModal" tabindex="-1" aria-labelledby="passwordResetModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="passwordResetModalLabel">Återställ lösenord</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div id="passwordResetResult"></div>

                <div class="alert alert-info">
                    <i class="bi bi-info-circle"></i>
                    <strong>Information:</strong> Ange din e-postadress så skickar vi en länk för att återställa ditt lösenord. Länken är giltig i 1 timme.
                </div>

                <form id="passwordResetRequestForm">
                    <div class="mb-3">
                        <label for="resetEmail" class="form-label">E-postadress <span class="text-danger">*</span></label>
                        <input type="email" class="form-control" id="resetEmail" name="resetEmail" placeholder="din@epost.se" required autocomplete="email">
                        <div class="form-text">Ange den e-postadress du registrerade dig med.</div>
                    </div>

                    <div class="text-muted small">
                        <i class="bi bi-shield-check"></i> Vi skickar aldrig ditt lösenord via e-post. Du får en säker länk för att skapa ett nytt lösenord.
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Avbryt</button>
                <button type="button" class="btn btn-primary" onclick="submitPasswordResetRequest()">Skicka återställningslänk</button>
            </div>
        </div>
    </div>
</div>

<script>
function submitPasswordResetRequest() {
    const form = document.getElementById('passwordResetRequestForm');
    const resultDiv = document.getElementById('passwordResetResult');

    // Clear previous messages
    resultDiv.innerHTML = '';

    // Get form data
    const resetEmail = document.getElementById('resetEmail').value.trim();

    // Validate required fields
    if (!resetEmail) {
        resultDiv.innerHTML = '<div class="alert alert-warning">Ange din e-postadress.</div>';
        return;
    }

    // Validate email format
    const emailRegex = /^[^\s@@]+@@[^\s@@]+\.[^\s@@]+$/;
    if (!emailRegex.test(resetEmail)) {
        resultDiv.innerHTML = '<div class="alert alert-warning">Ange en giltig e-postadress.</div>';
        return;
    }

    // Get anti-forgery token
    const token = document.querySelector('input[name="__RequestVerificationToken"]').value;

    // Show loading indicator
    resultDiv.innerHTML = '<div class="alert alert-info"><div class="spinner-border spinner-border-sm me-2"></div>Skickar återställningslänk...</div>';

    // Submit request
    fetch('/umbraco/surface/Member/RequestPasswordReset', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'RequestVerificationToken': token
        },
        body: JSON.stringify({
            email: resetEmail
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            resultDiv.innerHTML = '<div class="alert alert-success"><i class="bi bi-check-circle me-2"></i>' + data.message + '</div>';
            form.reset();
            // Close modal after 3 seconds
            setTimeout(function() {
                const modalElement = document.getElementById('passwordResetModal');
                const modal = bootstrap.Modal.getInstance(modalElement);
                if (modal) {
                    modal.hide();
                }
                resultDiv.innerHTML = '';
            }, 3000);
        } else {
            resultDiv.innerHTML = '<div class="alert alert-danger"><i class="bi bi-exclamation-triangle me-2"></i>' + data.message + '</div>';
        }
    })
    .catch(error => {
        console.error('Error:', error);
        resultDiv.innerHTML = '<div class="alert alert-danger">Ett fel uppstod vid skickandet. Försök igen senare.</div>';
    });
}
</script>
