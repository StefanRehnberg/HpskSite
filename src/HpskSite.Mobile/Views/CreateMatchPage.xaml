<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:sys="clr-namespace:System;assembly=mscorlib"
             xmlns:viewmodels="clr-namespace:HpskSite.Mobile.ViewModels"
             x:Class="HpskSite.Mobile.Views.CreateMatchPage"
             x:DataType="viewmodels:CreateMatchViewModel"
             Title="{Binding Title}"
             BackgroundColor="{StaticResource OffBlack}">

    <ScrollView>
        <VerticalStackLayout Padding="16" Spacing="16">

            <!-- Main Form Card -->
            <Border StrokeShape="RoundRectangle 12"
                    Stroke="Transparent"
                    BackgroundColor="{StaticResource CardBackgroundDark}"
                    Padding="0">
                <Border.Shadow>
                    <Shadow Brush="Black" Offset="0,2" Radius="8" Opacity="0.1"/>
                </Border.Shadow>

                <VerticalStackLayout Spacing="0">

                    <!-- Card Header -->
                    <Border BackgroundColor="{StaticResource Gray600}"
                            StrokeThickness="0"
                            Padding="16">
                        <HorizontalStackLayout Spacing="8" HorizontalOptions="Center">
                            <Label Text="âž•"
                                   FontSize="18"
                                   VerticalOptions="Center" />
                            <Label Text="Skapa ny match"
                                   FontSize="18"
                                   FontAttributes="Bold"
                                   VerticalOptions="Center"
                                   TextColor="{StaticResource White}" />
                        </HorizontalStackLayout>
                    </Border>

                    <!-- Divider -->
                    <BoxView HeightRequest="1"
                             Color="{StaticResource Gray600}" />

                    <!-- Card Body -->
                    <VerticalStackLayout Padding="20" Spacing="16">

                        <!-- Error Message -->
                        <Border BackgroundColor="#FEE2E2"
                                Stroke="{StaticResource Danger}"
                                StrokeShape="RoundRectangle 8"
                                Padding="12"
                                IsVisible="{Binding HasError}">
                            <HorizontalStackLayout Spacing="8">
                                <Label Text="âš ï¸"
                                       FontSize="16"
                                       VerticalOptions="Center" />
                                <Label Text="{Binding ErrorMessage}"
                                       TextColor="{StaticResource Danger}"
                                       VerticalOptions="Center" />
                            </HorizontalStackLayout>
                        </Border>

                        <!-- Match Name Field -->
                        <VerticalStackLayout Spacing="6">
                            <HorizontalStackLayout Spacing="6">
                                <Label Text="ðŸ·ï¸"
                                       FontSize="14"
                                       VerticalOptions="Center" />
                                <Label Text="Matchnamn"
                                       FontSize="14"
                                       FontAttributes="Bold"
                                       VerticalOptions="Center"
                                       TextColor="{StaticResource Gray200}" />
                                <Label Text="(valfritt)"
                                       FontSize="12"
                                       VerticalOptions="Center"
                                       TextColor="{StaticResource Gray400}" />
                            </HorizontalStackLayout>
                            <Border StrokeShape="RoundRectangle 8"
                                    Stroke="{StaticResource Gray500}"
                                    BackgroundColor="{StaticResource Gray600}"
                                    Padding="12,0"
                                    HeightRequest="48">
                                <Entry Text="{Binding MatchName}"
                                       Placeholder="T.ex. Klubbmatch juni"
                                       VerticalOptions="Center" />
                            </Border>
                        </VerticalStackLayout>

                        <!-- Weapon Class Field -->
                        <VerticalStackLayout Spacing="6">
                            <HorizontalStackLayout Spacing="6">
                                <Label Text="ðŸŽ¯"
                                       FontSize="14"
                                       VerticalOptions="Center" />
                                <Label Text="Vapenklass"
                                       FontSize="14"
                                       FontAttributes="Bold"
                                       VerticalOptions="Center"
                                       TextColor="{StaticResource Gray200}" />
                                <Label Text="*"
                                       FontSize="14"
                                       TextColor="{StaticResource Danger}" />
                            </HorizontalStackLayout>
                            <Border StrokeShape="RoundRectangle 8"
                                    Stroke="{StaticResource Gray500}"
                                    BackgroundColor="{StaticResource Gray600}"
                                    Padding="12,0"
                                    HeightRequest="48">
                                <Picker ItemsSource="{Binding WeaponClasses}"
                                        SelectedItem="{Binding SelectedWeaponClass}"
                                        Title="VÃ¤lj vapenklass"
                                        VerticalOptions="Center" />
                            </Border>
                        </VerticalStackLayout>

                        <!-- Start Date/Time Field -->
                        <VerticalStackLayout Spacing="6">
                            <HorizontalStackLayout Spacing="6">
                                <Label Text="ðŸ“…"
                                       FontSize="14"
                                       VerticalOptions="Center" />
                                <Label Text="Starttid"
                                       FontSize="14"
                                       FontAttributes="Bold"
                                       VerticalOptions="Center"
                                       TextColor="{StaticResource Gray200}" />
                                <Label Text="(valfritt)"
                                       FontSize="12"
                                       VerticalOptions="Center"
                                       TextColor="{StaticResource Gray400}" />
                            </HorizontalStackLayout>
                            <Grid ColumnDefinitions="*,*" ColumnSpacing="8">
                                <Border Grid.Column="0"
                                        StrokeShape="RoundRectangle 8"
                                        Stroke="{StaticResource Gray500}"
                                        BackgroundColor="{StaticResource Gray600}"
                                        Padding="12,0"
                                        HeightRequest="48">
                                    <DatePicker Date="{Binding StartDate}"
                                                MinimumDate="{x:Static sys:DateTime.Today}"
                                                Format="yyyy-MM-dd"
                                                VerticalOptions="Center" />
                                </Border>
                                <Border Grid.Column="1"
                                        StrokeShape="RoundRectangle 8"
                                        Stroke="{StaticResource Gray500}"
                                        BackgroundColor="{StaticResource Gray600}"
                                        Padding="12,0"
                                        HeightRequest="48">
                                    <TimePicker Time="{Binding StartTime}"
                                                Format="HH:mm"
                                                VerticalOptions="Center" />
                                </Border>
                            </Grid>
                            <Label Text="Deltagare kan inte registrera poÃ¤ng fÃ¶rrÃ¤n matchen startat"
                                   FontSize="11"
                                   TextColor="{StaticResource Gray400}" />
                        </VerticalStackLayout>

                        <!-- Divider -->
                        <BoxView HeightRequest="1"
                                 Color="{StaticResource Gray600}"
                                 Margin="0,8" />

                        <!-- Open Match Toggle -->
                        <Border StrokeShape="RoundRectangle 8"
                                Stroke="Transparent"
                                BackgroundColor="{StaticResource Gray600}"
                                Padding="16">
                            <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="12">
                                <Label Grid.Column="0"
                                       Text="ðŸ”“"
                                       FontSize="24"
                                       VerticalOptions="Center" />
                                <VerticalStackLayout Grid.Column="1" VerticalOptions="Center">
                                    <Label Text="Ã–ppen match"
                                           FontSize="14"
                                           FontAttributes="Bold"
                                           TextColor="{StaticResource White}" />
                                    <Label Text="Alla kan ansluta direkt"
                                           FontSize="12"
                                           TextColor="{StaticResource Gray400}" />
                                </VerticalStackLayout>
                                <Switch Grid.Column="2"
                                        IsToggled="{Binding IsOpen}"
                                        OnColor="{StaticResource Primary}"
                                        VerticalOptions="Center" />
                            </Grid>
                        </Border>

                        <!-- Handicap Toggle -->
                        <Border StrokeShape="RoundRectangle 8"
                                Stroke="Transparent"
                                BackgroundColor="{StaticResource Gray600}"
                                Padding="16">
                            <Grid ColumnDefinitions="Auto,*,Auto,Auto" ColumnSpacing="12">
                                <Label Grid.Column="0"
                                       Text="âš–ï¸"
                                       FontSize="24"
                                       VerticalOptions="Center" />
                                <VerticalStackLayout Grid.Column="1" VerticalOptions="Center">
                                    <HorizontalStackLayout Spacing="6">
                                        <Label Text="Handicap"
                                               FontSize="14"
                                               FontAttributes="Bold"
                                               TextColor="{StaticResource White}" />
                                        <Label Text="â„¹ï¸"
                                               FontSize="14"
                                               VerticalOptions="Center">
                                            <Label.GestureRecognizers>
                                                <TapGestureRecognizer Tapped="OnHandicapInfoTapped" />
                                            </Label.GestureRecognizers>
                                        </Label>
                                    </HorizontalStackLayout>
                                    <Label Text="Anvand handicap for rattvisare tavling"
                                           FontSize="12"
                                           TextColor="{StaticResource Gray400}" />
                                </VerticalStackLayout>
                                <Switch Grid.Column="2"
                                        IsToggled="{Binding HasHandicap}"
                                        OnColor="{StaticResource Primary}"
                                        VerticalOptions="Center" />
                            </Grid>
                        </Border>

                    </VerticalStackLayout>
                </VerticalStackLayout>
            </Border>

            <!-- Action Buttons -->
            <Grid ColumnDefinitions="*,*" ColumnSpacing="12">
                <Button Grid.Column="0"
                        Text="âœ• Avbryt"
                        Command="{Binding CancelCommand}"
                        BackgroundColor="{StaticResource Gray600}"
                        TextColor="{StaticResource White}"
                        FontAttributes="Bold"
                        HeightRequest="50"
                        CornerRadius="8" />
                <Button Grid.Column="1"
                        Text="âœ“ Skapa"
                        Command="{Binding CreateMatchCommand}"
                        BackgroundColor="{StaticResource Primary}"
                        TextColor="White"
                        FontAttributes="Bold"
                        HeightRequest="50"
                        CornerRadius="8"
                        IsEnabled="{Binding IsNotBusy}" />
            </Grid>

            <!-- Loading Indicator -->
            <ActivityIndicator IsRunning="{Binding IsBusy}"
                               IsVisible="{Binding IsBusy}"
                               Color="{StaticResource Primary}"
                               HorizontalOptions="Center" />

        </VerticalStackLayout>
    </ScrollView>

</ContentPage>
